#!/usr/bin/env ruby
# Set variables in the environment
require 'yaml'
require 'json'

# unless ARGV == 'virtualbox'
#   ARGV = 'vbox'
# end
puts ARGV.join(" ")
VARIABLES=YAML::load(File.read("config/variables.yaml"))
# VARIABLES.each {|k, v| p "export #{k.upcase}=\'#{v}\'" }
VARIABLES.each do |k,v|
  puts ENV[k.upcase]=v
  # p `export #{k.upcase.to_s}=#{v.to_s}`
  # p `export #{k.upcase}\=#{v}`
end

puts JSON.pretty_generate(YAML.load(File.read("config/#{( ARGV=='virtualbox' ? ARGV.join(" ") : 'vbox'  )}.yaml")))
# template_json=File.open( "tmp/template.json","w" )
# VARIABLES.each {|k, v| cmd="export #{k.upcase}=\'#{v}\'" }
# Load all variables from yaml into environment (except token since it's set)
# VARIABLES.each {|k, v| p `export #{k.upcase}\=\'#{v}\'` }
# template_json<<JSON.pretty_generate(YAML.load(File.read("config/#{ARGV.join(" ")}.yaml")))
# template_json.close
# # Convert yaml to json based on ARGV[0]
#
# # Build the project
# puts exec("packer build tmp/template.json")
# puts "packer build < #{template_json}"
